<!DOCTYPE html>
<html lang="es">
<head>
  <!-- Meta Tags -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Acceso al √°rea privada de DrYouu">
  <meta name="author" content="Yoel Ferreiro Naya">
  <meta name="robots" content="noindex, nofollow">
  
  <!-- Security Headers -->
  <meta http-equiv="X-Content-Type-Options" content="nosniff">
  <meta http-equiv="X-Frame-Options" content="SAMEORIGIN">
  <meta http-equiv="X-XSS-Protection" content="1; mode=block">
  
  <!-- Title -->
  <title>Acceso Privado - DrYouu</title>
  
  <!-- Stylesheets -->
  <link rel="stylesheet" href="/assets/css/styles.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="container nav-container">
      <a href="/index.html" class="nav-brand">DRYOUU</a>
      
      <ul class="nav-menu">
        <li><a href="/index.html" class="nav-link">Inicio</a></li>
        <li><a href="/public/about.html" class="nav-link">Sobre M√≠</a></li>
        <li><a href="/public/projects.html" class="nav-link">Proyectos</a></li>
        <li><a href="/public/contact.html" class="nav-link">Contacto</a></li>
      </ul>
      
      <button class="nav-toggle" aria-label="Toggle navigation">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>

  <!-- Login Section -->
  <div class="login-container">
    <div class="login-card">
      <div class="login-header">
        <div style="font-size: 3rem; margin-bottom: 1rem;">üîê</div>
        <h1 class="login-title">√Årea Privada</h1>
        <p class="login-subtitle">Inicia sesi√≥n con tu cuenta preferida</p>
      </div>
      
      <!-- Error Message (hidden by default) -->
      <div id="loginError" class="error-message hidden">
        Error de autenticaci√≥n. Por favor, intenta de nuevo.
      </div>
      
      <!-- OAuth2 Authentication Buttons -->
      <div class="oauth-buttons">
        <button type="button" id="googleLoginBtn" class="btn-oauth btn-oauth-google">
          <span class="oauth-icon">üîµ</span>
          <span>Continuar con Google</span>
        </button>
        
        <button type="button" id="appleLoginBtn" class="btn-oauth btn-oauth-apple">
          <span class="oauth-icon">‚ö™</span>
          <span>Continuar con Apple</span>
        </button>
      </div>
      
      <!-- Security Notice -->
      <div style="margin-top: 2rem; padding: 1rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem;">
        <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--info);">üîí Autenticaci√≥n Segura</h4>
        <p style="font-size: 0.85rem; color: var(--gray-400); line-height: 1.6; margin: 0;">
          Este sistema utiliza OAuth 2.0 para autenticaci√≥n con Google y Apple.
          Tus credenciales nunca son almacenadas en nuestro servidor.
        </p>
      </div>
      
      <!-- Help Text -->
      <div style="margin-top: 1.5rem; text-align: center;">
        <p style="font-size: 0.9rem; color: var(--gray-400);">
          ¬øNecesitas ayuda? 
          <a href="/public/contact.html" style="color: var(--primary-accent);">Contacta con el administrador</a>
        </p>
        <p style="font-size: 0.9rem; color: var(--gray-400); margin-top: 0.5rem;">
          <a href="/index.html" style="color: var(--gray-500);">‚Üê Volver al inicio</a>
        </p>
      </div>
      
      <!-- Demo Warning -->
      <div style="margin-top: 2rem; padding: 1rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem;">
        <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--error);">‚ö†Ô∏è Modo Demostraci√≥n</h4>
        <p style="font-size: 0.85rem; color: var(--gray-400); line-height: 1.6; margin: 0;">
          Esta es una implementaci√≥n de demostraci√≥n de OAuth 2.0. Para producci√≥n, debes:
        </p>
        <ul style="font-size: 0.85rem; color: var(--gray-400); margin-top: 0.5rem; padding-left: 1.5rem;">
          <li>Configurar credenciales reales en <code style="background: rgba(0,0,0,0.3); padding: 0.2em 0.4em; border-radius: 0.25rem;">config/auth.json</code></li>
          <li>Implementar un backend para manejar el intercambio de tokens</li>
          <li>Usar HTTPS en producci√≥n</li>
          <li>Nunca exponer client secrets en el c√≥digo del cliente</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script src="/assets/js/main.js"></script>
  <script src="/src/js/auth/oauth2.js"></script>
  <script>
    // OAuth2 Authentication Handler
    document.addEventListener('DOMContentLoaded', async () => {
      // Initialize OAuth2
      const oauth2 = new OAuth2Auth();
      
      // Load auth configuration
      try {
        const response = await fetch('/config/auth.json');
        const authConfig = await response.json();
        await oauth2.init(authConfig);
        
        // Setup Google login button
        const googleBtn = document.getElementById('googleLoginBtn');
        if (googleBtn) {
          googleBtn.addEventListener('click', async () => {
            try {
              googleBtn.disabled = true;
              googleBtn.innerHTML = '<span class="oauth-icon">üîµ</span><span>Conectando...</span>';
              await oauth2.authenticate('google');
            } catch (error) {
              console.error('Google auth error:', error);
              showError('Error al conectar con Google: ' + error.message);
              googleBtn.disabled = false;
              googleBtn.innerHTML = '<span class="oauth-icon">üîµ</span><span>Continuar con Google</span>';
            }
          });
        }
        
        // Setup Apple login button
        const appleBtn = document.getElementById('appleLoginBtn');
        if (appleBtn) {
          appleBtn.addEventListener('click', async () => {
            try {
              appleBtn.disabled = true;
              appleBtn.innerHTML = '<span class="oauth-icon">‚ö™</span><span>Conectando...</span>';
              await oauth2.authenticate('apple');
            } catch (error) {
              console.error('Apple auth error:', error);
              showError('Error al conectar con Apple: ' + error.message);
              appleBtn.disabled = false;
              appleBtn.innerHTML = '<span class="oauth-icon">‚ö™</span><span>Continuar con Apple</span>';
            }
          });
        }
        
      } catch (error) {
        console.error('Failed to load auth configuration:', error);
        showError('Error al cargar la configuraci√≥n de autenticaci√≥n. Por favor, verifica config/auth.json');
      }
      
      // Error display function
      function showError(message) {
        const errorDiv = document.getElementById('loginError');
        if (errorDiv) {
          errorDiv.textContent = message;
          errorDiv.classList.remove('hidden');
          
          setTimeout(() => {
            errorDiv.classList.add('hidden');
          }, 5000);
        }
      }
      
      // Check if returning from OAuth callback
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.has('code') || urlParams.has('error')) {
        try {
          const result = await oauth2.handleCallback();
          if (result.success) {
            // Store session and redirect
            localStorage.setItem('dryouu_session', JSON.stringify({
              user: result.user,
              loginTime: Date.now(),
              expiry: Date.now() + 86400000 // 24 hours
            }));
            window.location.href = '/private/dashboard.html';
          }
        } catch (error) {
          console.error('OAuth callback error:', error);
          showError('Error en la autenticaci√≥n: ' + error.message);
        }
      }
    });
  </script>
</body>
</html>
